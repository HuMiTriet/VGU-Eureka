# Facebook Sign In Authentication
- Users can select Facebook as a sign-in option for our application.
- Flutter also have libraries that already integrate Facebook Sign-in process. For our application, we use [flutter_login_facebook 1.4.1](https://pub.dev/packages/flutter_login_facebook) for our Facebook Sign In Process.
## Configuration
- We need to configurate our application in [Facebook Developer Console](https://developers.facebook.com)

[Android setup](https://pub.dev/packages/flutter_login_facebook#android)

[iOS setup](https://pub.dev/packages/flutter_login_facebook#ios)

[App configuration details](https://pub.dev/packages/flutter_login_facebook#configure-your-project)

- After having done all the steps above, proceed to [Firebase console](https://console.firebase.google.com/u/0/project/_/authentication/providers), enable Facebook Sign-in method and [follow the instructions](https://firebase.google.com/docs/auth/android/facebook-login).

### Reminder
Since our application is in developer mode, signing in to the application only available using the account that initialize the application in [Facebook Developers](https://https://developers.facebook.com) or using some test users generated by Facebook.
## Sign In Process
- After having done all the configuration, you can now use the Facebook as a sign-in method.
- The first step is to invoke the Facebook Sign In UI. Our application requests user public profile and email. The parameter 'res' contains the status depends on user successful login or user abort login process.
```dart
// Create an instance of FacebookLogin
    final fb = FacebookLogin(debug: true);

    // Log in
    final res = await fb.logIn(permissions: [
      FacebookPermission.publicProfile,
      FacebookPermission.email,
    ]);
```
- We will use the variable 'res' to obtain the access token from the result if user login process is success
```dart
    // Check result status
    switch (res.status) {
      case FacebookLoginStatus.success:
        // Logged in
        // Send access token to server for validation and auth
        final accessToken = res.accessToken;
        // Get profile data
        final profile = await fb.getUserProfile();
        // Get user profile image url
        final imageUrl = await fb.getProfileImageUrl(width: 100);
        // Get email (since we request email permission)
        final email = await fb.getUserEmail();
        // But user can decline permission
        if (email != null) {
          devtools.log('And your email is $email');
        }
```
- We then use the access token above to get the Facebook credential, and exchange this credential for a Firebase credential. This credential will be use to retrieve the user from Firebase.
```dart
        // Obtain credential from access token
        var cred = FacebookAuthProvider.credential(accessToken!.token);
        // Get the user
        final user = (await FirebaseAuth.instance.signInWithCredential(cred))
            .user as User;
        // Create a Firestore user
        final authUser = AuthUser(
            isEmailVerified: user.emailVerified,
            uid: user.uid,
            email: user.email,
            phoneNumber: user.phoneNumber,
            displayName: user.displayName);
        // Check if this user already exists
        var userExists = Firestore.userExists(authUser.uid);
        userExists.then((value) => {
              if (value)
              // Update their info (avatar, name, etc...)
                {Firestore.updateUserInfo(authUser)}
              else
              // Add them to Firestore
                {Firestore.addUserInfo(authUser)}
            });
```
- After the above steps, navigate them to the main screen
```dart
        // Navigate user to main screen
        Navigator.pushAndRemoveUntil(
          context,
          MaterialPageRoute(
            builder: (context) => MainView(),
          ),
          (route) => false,
        );
        break;
```
- In case user cancels the login process
```dart
      case FacebookLoginStatus.cancel:
        // User cancel log in
        devtools.log('Login aborted',
            name: 'login_view.dart: signInWithFacebook');
        break;
```
- In case wrong user login information
```dart
      case FacebookLoginStatus.error:
        // Log in failed
        devtools.log('Error while log in: ${res.error}');
        break;
    }
  }
```